Name: orca-nodeagent 
License: Eclipse
Summary: Provides programmatic access to resources. 
Version: <VERSION>
Release: 1
Vendor: Geni ORCA Project [geni-orca@renci.org]
URL: https://geni-orca.renci.org/trac
Group: System
Prefix: /
%define _prefix /
%define _rpmdir target/rpm
%define _target_cpu noarch
BuildRoot: <RMPBUILDROOT>
AutoReqProv: no
Requires: /bin/bash
Requires: /usr/java/latest/bin/java
Requires: /usr/java/latest/bin/keytool

%description
The Orca Node Agent provides a platform for resource drivers.

%post
# add keytool on the path
ln -s -f /usr/java/latest/bin/keytool /opt/orca/nodeagent/bin
ln -s -f /usr/java/latest/bin/java /opt/orca/nodeagent/bin
chmod u+x /opt/orca/nodeagent/bin/*.sh
chmod u+x /etc/init.d/orca-nodeagent

if [ -x /usr/lib/lsb/install_initd ]; then               # SuSE
	/usr/lib/lsb/install_initd /etc/init.d/orca-nodeagent
elif [ -x /sbin/chkconfig ]; then                        # RHEL
	/sbin/chkconfig --add orca-nodeagent
else                                                     # other
	for i in 2 3 4 5; do
		ln -sf /etc/init.d/orca-nodeagent /etc/rc.d/rc${i}.d/S15orca-nodeagent
	done
	for i in 1 6; do
		ln -sf /etc/init.d/orca-nodeagent /etc/rc.d/rc${i}.d/K10orca-nodeagent
	done
fi

if [ -r /opt/orca/nodeagent/data/drivers.xml ]; then
	echo "drivers.xml already exists"
else
	cp /opt/orca/nodeagent/temp/drivers.xml /opt/orca/nodeagent/data/drivers.xml
fi

rm -rf /opt/orca/nodeagent/temp


/etc/init.d/orca-nodeagent start 2

%preun
/etc/init.d/orca-nodeagent stop
if [ $1 = 0 ]; then        #only on uninstall, not on upgrades.
  if [ -x /usr/lib/lsb/remove_initd ]; then          # SuSE
    /usr/lib/lsb/install_initd /etc/init.d/orca-nodeagent
  elif [ -x /sbin/chkconfig ]; then                  # RHEL
    /sbin/chkconfig --del orca-nodeagent
  else                                               # other
    rm -f /etc/rc.d/rc?.d/???orca-nodeagent
  fi
fi

rm -f /opt/orca/nodeagent/bin/java
rm -f /opt/orca/nodeagent/bin/keytool
rm -f /opt/orca/nodeagent/bin/*pid
rm -rf /opt/orca/nodeagent/log

%postun

%files
%{_prefix}/etc/init.d/orca-nodeagent
%{_prefix}/opt/orca/nodeagent
